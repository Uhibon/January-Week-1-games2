<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Booha Sentence Builder – January Week 1</title>
<meta name="theme-color" content="#0b1530" />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&display=swap" rel="stylesheet" />
<style>
:root{
  --bg:#0b1530;
  --ink:#ffffff;
  --paper:#ffffffee;
  --muted:#a9b3c7;
  --ok:#22c55e;
  --bad:#e53935;
  --heart:#ff5ea8;
  --steam:#ffffff;
  --outline:#ffffff33;
  --radius:22px;
  --glow:0 0 0 2px rgba(255,255,255,.06), 0 6px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
  --c1:#ff6ec7; --c2:#5ee6ff; --c3:#ffd166; --c4:#8aff80; --c5:#c77dff;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif;
  color:var(--ink); background: radial-gradient(1200px 900px at 50% -10%, #142349 0%, #0b1530 50%, #071127 100%) fixed;
  line-height:1.4; overflow-y:auto; -webkit-overflow-scrolling:touch;
}
header{
  text-align:center; padding:24px 16px 8px;
}
.h1{
  font-family:'Cinzel', serif; font-weight:900; letter-spacing:.5px; font-size: clamp(28px, 5vw, 44px);
  text-transform: uppercase;
  text-shadow: 0 2px 0 rgba(0,0,0,.4);
}
.sub{color:var(--muted); font-size:clamp(14px, 2.5vw, 16px); margin-top:6px}
.wrap{max-width:1100px; margin:0 auto; padding:12px 16px 56px}

.panel{
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  border:1px solid var(--outline);
  border-radius: var(--radius);
  box-shadow: var(--glow);
  padding:16px;
}

/* JP/Hira block */
.jp{
  font-weight:700; font-size: clamp(16px, 3.2vw, 22px);
}
.hira{
  margin-top:6px; color:#cfd7ea; font-size:clamp(13px, 2.8vw, 16px)
}

/* Areas */
.stage{display:grid; gap:14px}
.area-label{font-size:12px; color:#c2cae0; letter-spacing:.08em; text-transform:uppercase}
.pool, .answer{
  min-height:64px; display:flex; flex-wrap:wrap; gap:10px; align-items:flex-start; padding:12px;
  background:rgba(0,0,0,.18); border:1px dashed rgba(255,255,255,.2);
  border-radius: calc(var(--radius) - 8px);
}

/* Word chips */
.word{
  position:relative;
  padding:12px 14px; border-radius:18px; font-weight:800; letter-spacing:.2px;
  background:
    repeating-linear-gradient(135deg, var(--s1) 0 14px, var(--s2) 14px 28px, var(--s3) 28px 42px);
  color:#111; user-select:none; touch-action:none; cursor:grab;
  filter: drop-shadow(0 3px 0 rgba(0,0,0,.25));
  white-space:nowrap; word-break:keep-all; -webkit-tap-highlight-color:transparent;
  transition:transform .15s ease;
  animation:barber 10s linear infinite;
}
.word:active{transform:scale(.98)}
.word[data-placed="true"]{cursor:grab}
@keyframes barber{
  from{background-position:0 0}
  to{background-position:300px 300px}
}

/* Controls */
.controls{display:flex; flex-wrap:wrap; gap:10px; margin-top:8px}
.btn{
  border:none; border-radius:999px; padding:12px 18px; font-weight:900; letter-spacing:.4px;
  background:#18254a; color:var(--ink); cursor:pointer; box-shadow:var(--glow);
}
.btn:disabled{opacity:.5; cursor:not-allowed}
.btn.primary{
  background: radial-gradient(120% 120% at 30% 30%, #1ee99a 0%, #15c473 50%, #0ea85d 100%);
  color:#00230f; text-shadow:0 1px 0 rgba(255,255,255,.45);
  box-shadow: 0 0 0 3px rgba(34,197,94,.25), 0 10px 24px rgba(16,185,129,.35);
}
.btn.primary.glow{
  box-shadow: 0 0 0 5px rgba(34,197,94,.22), 0 0 16px rgba(34,197,94,.75), 0 12px 26px rgba(0,0,0,.45);
}
.meta{margin-left:auto; color:#d2dbef; font-weight:700}
.score{margin-left:0}

/* Feedback */
.answer.shake{animation:shake .38s ease}
@keyframes shake{
  10%, 90% { transform: translateX(-3px); }
  20%, 80% { transform: translateX(4px); }
  30%, 50%, 70% { transform: translateX(-6px); }
  40%, 60% { transform: translateX(6px); }
}

/* Particles container */
.fx{position:fixed; inset:0; pointer-events:none; overflow:hidden}
.heart, .steam{
  position:absolute; font-weight:900;
  transform:translate(-50%,-50%); opacity:0;
}

/* hearts */
.heart{
  color:var(--heart); font-size:22px; text-shadow:0 2px 0 rgba(0,0,0,.25);
  animation:heartUp 900ms ease-out forwards;
}
@keyframes heartUp{
  0%{opacity:0; transform:translate(-50%,-10px) scale(.6) rotate(0deg)}
  10%{opacity:1}
  100%{opacity:0; transform:translate(-50%,-120px) scale(1.4) rotate(12deg)}
}

/* steam puffs */
.steam{
  width:14px; height:14px; border-radius:999px;
  background: radial-gradient(circle at 40% 40%, var(--steam), rgba(255,255,255,.6) 60%, rgba(255,255,255,0) 70%);
  box-shadow: 0 2px 6px rgba(0,0,0,.2);
  animation:steamUp 800ms ease-out forwards;
}
@keyframes steamUp{
  0%{opacity:0; transform:translate(-50%,0) scale(.6)}
  15%{opacity:.9}
  100%{opacity:0; transform:translate(-50%,-80px) scale(1.2)}
}

/* Progress bar */
.progress{
  height:10px; background:rgba(255,255,255,.1); border-radius:999px; overflow:hidden;
  margin-top:10px;
}
.progress > i{
  display:block; height:100%; width:0%;
  background:linear-gradient(90deg, #42e6ff, #7cf78a, #ffd166);
  transition:width .3s ease;
}

/* Mobile tweaks */
@media (max-width: 640px){
  .pool, .answer{gap:8px; padding:10px}
  .word{padding:10px 12px; border-radius:16px; font-size:16px}
}
footer{
  text-align:center; color:#c9d4ec; opacity:.9; padding:24px 12px 40px; font-family:'Cinzel', serif; font-weight:700;
}
</style>
</head>
<body>
<header>
  <div class="h1">The BOO-RICULUM</div>
  <div class="sub">Sentence Builder ・ 並べ替え（英語の語順を作ろう）</div>
</header>

<div class="wrap">
  <div class="panel">
    <div id="jp" class="jp"></div>
    <div id="hira" class="hira"></div>

    <div class="stage" aria-live="polite">
      <div class="area">
        <div class="area-label">Word Bank</div>
        <div id="pool" class="pool" aria-label="Word bank"></div>
      </div>

      <div class="area">
        <div class="area-label">Your Sentence</div>
        <div id="answer" class="answer" aria-label="Your sentence" data-accepts="word"></div>
      </div>
    </div>

    <div class="controls">
      <button id="checkBtn" class="btn primary glow">Check</button>
      <button id="undoBtn" class="btn">Undo</button>
      <button id="clearBtn" class="btn">Clear</button>
      <button id="restartBtn" class="btn">Restart</button>
      <div class="meta score">Score: <span id="score">0</span>/<span id="total">0</span></div>
      <div class="meta">Card: <span id="idx">1</span>/<span id="len">1</span></div>
    </div>
    <div class="progress"><i id="bar"></i></div>
  </div>
</div>

<div class="fx" id="fx"></div>

<footer>Bryan’s English School</footer>

<script>
/* ---------- DATA (15) ---------- */
const DATA = [
  { en:"I will study every day.", jp:"毎日勉強します。", hira:"まいにち べんきょう します" },
  { en:"I’m going to try something new.", jp:"新しいことに挑戦します。", hira:"あたらしい こと に ちょうせん します" },
  { en:"I will do my best this year.", jp:"今年は全力を尽くします。", hira:"ことし は ぜんりょく を つくし ます" },
  { en:"I will make a new friend.", jp:"新しい友だちを作ります。", hira:"あたらしい ともだち を つくり ます" },
  { en:"I will not be late anymore.", jp:"もう遅刻しません。", hira:"もう ちこく しません" },
  { en:"I will help my classmates.", jp:"クラスメイトを手伝います。", hira:"クラスメイト を てつだい ます" },
  { en:"I will clean my desk today.", jp:"今日は机を片づけます。", hira:"きょう は つくえ を かたづけ ます" },
  { en:"I will read more books.", jp:"もっと本を読みます。", hira:"もっと ほん を よみ ます" },
  { en:"I will start a good habit.", jp:"良い習慣を始めます。", hira:"よい しゅうかん を はじめ ます" },
  { en:"I will speak more English.", jp:"もっと英語を話します。", hira:"もっと えいご を はなし ます" },
  { en:"I will write in my diary every week.", jp:"毎週日記を書きます。", hira:"まいしゅう にっき を かき ます" },
  { en:"I will wake up earlier.", jp:"もっと早く起きます。", hira:"もっと はやく おき ます" },
  { en:"I will listen carefully in class.", jp:"授業でしっかり聞きます。", hira:"じゅぎょう で しっかり きき ます" },
  { en:"I will smile more.", jp:"もっと笑います。", hira:"もっと わらい ます" },
  { en:"I will enjoy learning.", jp:"学ぶことを楽しみます。", hira:"まなぶ こと を たのしみ ます" },
];

/* ---------- CONFIG ---------- */
const SOUND_OK = new Audio("assets/audio/sugoi.mp3");
const SOUND_BAD = new Audio("assets/audio/yada.mp3");
SOUND_OK.preload = "auto"; SOUND_BAD.preload = "auto";

/* ---------- STATE ---------- */
let order = shuffle([...DATA.keys()]);
let i = 0;
let score = 0;

/* ---------- DOM ---------- */
const jp = document.getElementById('jp');
const hira = document.getElementById('hira');
const pool = document.getElementById('pool');
const ans = document.getElementById('answer');
const scoreEl = document.getElementById('score');
const totalEl = document.getElementById('total');
const idxEl = document.getElementById('idx');
const lenEl = document.getElementById('len');
const bar = document.getElementById('bar');
const fx = document.getElementById('fx');

const btnCheck = document.getElementById('checkBtn');
const btnUndo = document.getElementById('undoBtn');
const btnClear = document.getElementById('clearBtn');
const btnRestart = document.getElementById('restartBtn');

/* ---------- INIT ---------- */
totalEl.textContent = DATA.length;
lenEl.textContent = DATA.length;
mountCard();

btnCheck.addEventListener('click', onCheck);
btnUndo.addEventListener('click', onUndo);
btnClear.addEventListener('click', onClear);
btnRestart.addEventListener('click', onRestart);

/* ---------- LOGIC ---------- */
function mountCard(){
  const item = DATA[ order[i] ];
  idxEl.textContent = i+1;
  jp.textContent = item.jp;
  hira.textContent = item.hira || "";

  // clear areas
  pool.innerHTML = '';
  ans.innerHTML = '';
  ans.classList.remove('shake');

  // split into tokens
  const words = tokenize(item.en);
  const shuffled = shuffle(words.slice());

  // build pool tiles
  for(const w of shuffled){
    pool.appendChild(makeWord(w));
  }

  // allow simple pointer tap-to-move
  pool.addEventListener('click', onPoolClick);
  ans.addEventListener('click', onAnsClick);

  // progress bar
  bar.style.width = `${(i / DATA.length) * 100}%`;
}

function tokenize(sentence){
  // Keep punctuation with ending token; split by spaces.
  // Example: "every day." -> ["every","day."]
  return sentence.trim().split(/\s+/);
}

function makeWord(text){
  const el = document.createElement('button');
  el.type = 'button';
  el.className = 'word';
  el.textContent = text;
  el.setAttribute('draggable','true');
  el.dataset.placed = "false";

  // assign stripe colors per tile
  const palette = pickPalette();
  el.style.setProperty('--s1', palette[0]);
  el.style.setProperty('--s2', palette[1]);
  el.style.setProperty('--s3', palette[2]);

  // DnD
  el.addEventListener('dragstart', dragStart);
  el.addEventListener('dragend', dragEnd);

  return el;
}

/* Tap-to-move */
function onPoolClick(e){
  const w = e.target.closest('.word'); if(!w) return;
  if(w.parentElement !== pool) return;
  moveToAnswer(w);
}
function onAnsClick(e){
  const w = e.target.closest('.word'); if(!w) return;
  if(w.parentElement !== ans) return;
  moveToPool(w);
}

function moveToAnswer(node){
  node.dataset.placed = "true";
  ans.appendChild(node);
}
function moveToPool(node){
  node.dataset.placed = "false";
  pool.appendChild(node);
}

/* Drag & drop (reorder + move) */
let dragged = null;

function dragStart(e){
  dragged = e.currentTarget;
  e.dataTransfer?.setData('text/plain', 'word');
  requestAnimationFrame(()=> dragged.style.opacity = .6);
}
function dragEnd(){
  if(dragged){ dragged.style.opacity = 1; dragged = null; }
}

[pool, ans].forEach(area=>{
  area.addEventListener('dragover', e=>{ e.preventDefault(); });
  area.addEventListener('drop', e=>{
    e.preventDefault();
    if(!dragged) return;
    if(e.currentTarget === ans){
      dragged.dataset.placed = "true";
      ans.appendChild(dragged);
    }else{
      dragged.dataset.placed = "false";
      pool.appendChild(dragged);
    }
  });
});

/* Buttons */
function onUndo(){
  // remove last in answer back to pool
  const last = ans.lastElementChild;
  if(last) moveToPool(last);
}
function onClear(){
  // move all back
  [...ans.children].forEach(c=> moveToPool(c));
}

function onCheck(){
  const item = DATA[ order[i] ];
  const built = [...ans.children].map(el=>el.textContent).join(' ').trim();
  const correct = item.en.trim();

  if(built === correct){
    score++; scoreEl.textContent = score;
    successFX();
    SOUND_OK.currentTime = 0; SOUND_OK.play().catch(()=>{});
    // go next after a moment
    setTimeout(()=>{
      i++;
      if(i >= DATA.length){
        bar.style.width = '100%';
        finishScreen();
      }else{
        mountCard();
      }
    }, 900);
  }else{
    failureFX(ans);
    SOUND_BAD.currentTime = 0; SOUND_BAD.play().catch(()=>{});
    ans.classList.remove('shake'); void ans.offsetWidth; ans.classList.add('shake');
  }
}

/* Finish */
function finishScreen(){
  jp.textContent = "おしまい！ Great work!";
  hira.textContent = "Score: " + score + " / " + DATA.length;
  pool.innerHTML = '';
  ans.innerHTML = '';

  // celebratory hearts sweep proportional to score
  const ratio = score / DATA.length;
  heartBurst(window.innerWidth/2, window.innerHeight*0.6, Math.floor(80 * ratio) + 20);
}

function onRestart(){
  score = 0; scoreEl.textContent = 0;
  order = shuffle([...DATA.keys()]);
  i = 0;
  mountCard();
}

/* ---------- FX ---------- */
function successFX(){
  // Hearts from the answer area center
  const rect = ans.getBoundingClientRect();
  const x = rect.left + rect.width/2;
  const y = rect.top + rect.height/2;
  heartBurst(x, y, 28);
}
function failureFX(el){
  // Steam puffs from the answer area
  const rect = el.getBoundingClientRect();
  const x = rect.left + rect.width/2;
  const y = rect.top + rect.height/2 + 8;
  steamBurst(x, y, 14);
}

function heartBurst(x, y, n=24){
  for(let k=0;k<n;k++){
    const h = document.createElement('div');
    h.className = 'heart';
    h.textContent = '❤';
    const dx = (Math.random()*220 - 110);
    const dy = (Math.random()*40 - 20);
    const delay = Math.random()*120;
    h.style.left = (x + dx) + 'px';
    h.style.top  = (y + dy) + 'px';
    h.style.animationDelay = delay+'ms';
    fx.appendChild(h);
    setTimeout(()=> h.remove(), 1200);
  }
}

function steamBurst(x, y, n=12){
  for(let k=0;k<n;k++){
    const s = document.createElement('div');
    s.className = 'steam';
    const angle = (Math.random()*Math.PI) - Math.PI/2; // spread left/right
    const radius = Math.random()*60;
    const ox = Math.cos(angle)*radius;
    const oy = Math.sin(angle)*radius*0.4;
    const delay = Math.random()*80;
    s.style.left = (x + ox) + 'px';
    s.style.top  = (y + oy) + 'px';
    s.style.animationDelay = delay+'ms';
    fx.appendChild(s);
    setTimeout(()=> s.remove(), 900);
  }
}

/* ---------- Utils ---------- */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = (Math.random()*(i+1))|0;
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
function pickPalette(){
  const sets = [
    ['var(--c1)','var(--c2)','var(--c3)'],
    ['var(--c2)','var(--c3)','var(--c4)'],
    ['var(--c3)','var(--c4)','var(--c5)'],
    ['var(--c4)','var(--c5)','var(--c2)'],
    ['var(--c5)','var(--c1)','var(--c3)'],
  ];
  return sets[(Math.random()*sets.length)|0];
}

/* Make the page scroll nicely on mobile (no sticky trap) */
document.addEventListener('touchmove', ()=>{}, {passive:true});
</script>
</body>
</html>
