<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Booha Sentence Builder – January Week 1</title>
<meta name="theme-color" content="#0b1530" />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet" />
<style>
:root{
  --bg:#0b1530; --ink:#ffffff; --muted:#9fb0d6; --outline:#ffffff26;
  --ok:#22c55e; --glow-ok:0 0 0 5px rgba(34,197,94,.22), 0 0 22px rgba(34,197,94,.8), 0 12px 26px rgba(0,0,0,.5);
  --card:linear-gradient(90deg,#ff6ec7 0%,#ff6ec7 16.6%,#5ee6ff 16.6%,#5ee6ff 33.2%,#ffd166 33.2%,#ffd166 49.8%,#8aff80 49.8%,#8aff80 66.4%,#c77dff 66.4%,#c77dff 83%,#fff680 83%,#fff680 100%);
  --radius:26px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif;
  background: radial-gradient(1200px 900px at 50% -10%, #142349 0%, #0b1530 55%, #08102a 100%) fixed;
  -webkit-overflow-scrolling:touch;
}
header{padding:26px 16px 10px; text-align:center}
.h1{font-family:'Cinzel',serif; font-weight:900; letter-spacing:.5px; font-size:clamp(28px,5vw,44px); text-transform:uppercase; text-shadow:0 2px 0 rgba(0,0,0,.4)}
.h2{font-family:'Cinzel',serif; font-weight:900; letter-spacing:.3px; font-size:clamp(16px,3.6vw,20px); opacity:.9}
.h3{font-weight:800; letter-spacing:.2px; font-size:clamp(18px,3.8vw,24px); margin-top:6px}
.h4{font-weight:800; letter-spacing:.1px; font-size:clamp(16px,3.6vw,20px); color:#d7e2ff}

.wrap{max-width:1100px; margin:0 auto; padding:8px 16px 80px}
.panel{
  padding:16px; border:1px solid var(--outline); border-radius:var(--radius);
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
  box-shadow: 0 6px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
}
.jpCard{
  position:relative; border-radius:var(--radius); overflow:hidden; border:1px solid var(--outline);
  background:var(--card); height:auto; min-height:120px;
}
.jpCard::before{
  content:""; position:absolute; inset:0; background:var(--card); opacity:.85;
  background-size: 1200px 100%;
  animation:stripeSlide 20s linear infinite;
}
@keyframes stripeSlide{
  from{background-position:0 0} to{background-position:1200px 0}
}
.jpText{
  position:relative; padding:18px 18px; font-weight:900; letter-spacing:.5px;
  font-size:clamp(22px,4.4vw,34px); color:#0b1530; text-shadow:0 1px 0 rgba(255,255,255,.55);
}
.hira{margin:10px 6px 12px; color:#cfe1ff; font-size:clamp(14px,3.2vw,18px); font-weight:600}

/* word chips area */
.answer{
  display:flex; flex-wrap:wrap; gap:12px; align-items:flex-start; padding:12px 6px; min-height:72px;
}
.word{
  user-select:none; -webkit-tap-highlight-color:transparent; cursor:grab;
  white-space:nowrap; word-break:keep-all;
  border:none; border-radius:18px; padding:14px 18px; font-weight:900; letter-spacing:.25px;
  font-size:clamp(18px,4.4vw,26px); color:#06101f; background:#fff;
  box-shadow: 0 0 0 3px var(--chip), 0 10px 22px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.6);
  text-shadow:0 1px 0 rgba(255,255,255,.65);
  outline:none;
}
.word:active{transform:scale(.98)}
.word[draggable="true"]{touch-action:none}

/* check button */
.ctaWrap{display:flex; justify-content:center; margin-top:10px}
.btn{
  border:none; border-radius:999px; padding:16px 28px; font-weight:900; letter-spacing:.5px;
  background: radial-gradient(120% 120% at 30% 30%, #1ee99a 0%, #15c473 50%, #0ea85d 100%);
  color:#00230f; text-shadow:0 1px 0 rgba(255,255,255,.45);
  box-shadow: var(--glow-ok); cursor:pointer; font-size:clamp(18px,4.2vw,22px);
}

/* feedback reveal */
.correctLine{margin-top:8px; color:#d7e2ff; font-weight:800; opacity:0; transform:translateY(6px); transition:all .25s ease}
.correctLine.show{opacity:1; transform:translateY(0)}

/* end screen */
.end{
  text-align:center; padding:24px 12px 40px;
}
.end h2{font-family:'Cinzel',serif; font-weight:900; font-size:clamp(26px,6vw,40px); margin:0 0 8px}
.end .score{font-weight:900; font-size:clamp(20px,5vw,28px); color:#d7e2ff}

/* BIG FX layer */
.fx{position:fixed; inset:0; pointer-events:none; overflow:hidden}
.heart{
  position:absolute; font-weight:900; color:#ff4f9e; text-shadow:0 4px 0 rgba(0,0,0,.35);
  font-size: clamp(40px, 8vw, 80px);
  animation:heartBoom 1200ms ease-out forwards;
}
@keyframes heartBoom{
  0%{opacity:0; transform:translate(-50%,-20px) scale(.6) rotate(0)}
  15%{opacity:1}
  100%{opacity:0; transform:translate(-50%,-220px) scale(1.6) rotate(12deg)}
}
.smoke{
  position:absolute; width: clamp(40px, 14vw, 120px); height: clamp(40px, 14vw, 120px);
  border-radius:50%;
  background: radial-gradient(circle at 40% 40%, #fff, rgba(255,255,255,.8) 60%, rgba(255,255,255,0) 72%);
  box-shadow: 0 10px 32px rgba(0,0,0,.45);
  animation:smokeRise 1400ms ease-out forwards;
  filter: blur(1px);
}
@keyframes smokeRise{
  0%{opacity:0; transform:translate(-50%,0) scale(.7)}
  20%{opacity:.95}
  100%{opacity:0; transform:translate(-50%,-240px) scale(1.35)}
}

/* accessibility + mobile niceties */
.answer.shake{animation:shake .4s ease}
@keyframes shake{
  10%, 90% { transform: translateX(-4px) }
  20%, 80% { transform: translateX(5px) }
  30%, 50%, 70% { transform: translateX(-7px) }
  40%, 60% { transform: translateX(7px) }
}

footer{ text-align:center; color:#c9d4ec; opacity:.9; padding:24px 12px 40px; font-family:'Cinzel',serif; font-weight:700 }

@media (max-width: 640px){
  .panel{padding:14px}
  .jpText{padding:16px}
  .answer{gap:10px}
}
</style>
</head>
<body>
<header>
  <div class="h1">THE BOO-RICULUM</div>
  <div class="h2">GAMES &amp; QUIZZES</div>
  <div class="h3">January Week 1 – Sentences</div>
  <div class="h4">１月第１週 – 文の練習</div>
</header>

<div class="wrap">
  <div class="panel">
    <div class="jpCard"><div id="jp" class="jpText"></div></div>
    <div id="hira" class="hira"></div>

    <div id="answer" class="answer" aria-label="英語の語順を並べ替え"></div>
    <div id="correctLine" class="correctLine"></div>

    <div class="ctaWrap">
      <button id="checkBtn" class="btn">Check</button>
    </div>
  </div>

  <div class="end" id="end" style="display:none">
    <h2>結果</h2>
    <div class="score" id="scoreText"></div>
    <div id="msg" class="h4" style="margin-top:10px"></div>
  </div>
</div>

<div class="fx" id="fx"></div>

<footer>Bryan’s English School</footer>

<script>
/* ---------- DATA ---------- */
const DATA = [
  { en:"I will study every day.", jp:"毎日勉強します。", hira:"まいにち べんきょう します" },
  { en:"I’m going to try something new.", jp:"新しいことに挑戦します。", hira:"あたらしい こと に ちょうせん します" },
  { en:"I will do my best this year.", jp:"今年は全力を尽くします。", hira:"ことし は ぜんりょく を つくし ます" },
  { en:"I will make a new friend.", jp:"新しい友だちを作ります。", hira:"あたらしい ともだち を つくり ます" },
  { en:"I will not be late anymore.", jp:"もう遅刻しません。", hira:"もう ちこく しません" },
  { en:"I will help my classmates.", jp:"クラスメイトを手伝います。", hira:"クラスメイト を てつだい ます" },
  { en:"I will clean my desk today.", jp:"今日は机を片づけます。", hira:"きょう は つくえ を かたづけ ます" },
  { en:"I will read more books.", jp:"もっと本を読みます。", hira:"もっと ほん を よみ ます" },
  { en:"I will start a good habit.", jp:"良い習慣を始めます。", hira:"よい しゅうかん を はじめ ます" },
  { en:"I will speak more English.", jp:"もっと英語を話します。", hira:"もっと えいご を はなし ます" },
  { en:"I will write in my diary every week.", jp:"毎週日記を書きます。", hira:"まいしゅう にっき を かき ます" },
  { en:"I will wake up earlier.", jp:"もっと早く起きます。", hira:"もっと はやく おき ます" },
  { en:"I will listen carefully in class.", jp:"授業でしっかり聞きます。", hira:"じゅぎょう で しっかり きき ます" },
  { en:"I will smile more.", jp:"もっと笑います。", hira:"もっと わらい ます" },
  { en:"I will enjoy learning.", jp:"学ぶことを楽しみます。", hira:"まなぶ こと を たのしみ ます" },
];

/* ---------- AUDIO (paths) ---------- */
const SND_OK = new Audio("assets/audio/sugoi.mp3");
const SND_BAD = new Audio("assets/audio/yada.mp3");
const SND_R0_5 = new Audio("assets/audio/result_0-5.mp3");
const SND_R6_10 = new Audio("assets/audio/result_6-10.mp3");
const SND_R6_14 = new Audio("assets/audio/result_11-14.mp3");
const SND_R15 = new Audio("assets/audio/result_15.mp3");
[SND_OK,SND_BAD,SND_R0_5,SND_R6_10,SND_R15].forEach(a=>{ a.preload="auto"; a.volume=1; });

/* ---------- STATE ---------- */
let order = shuffle([...DATA.keys()]);
let i = 0, score = 0;

/* ---------- DOM ---------- */
const jp = document.getElementById('jp');
const hira = document.getElementById('hira');
const ans = document.getElementById('answer');
const correctLine = document.getElementById('correctLine');
const checkBtn = document.getElementById('checkBtn');
const fx = document.getElementById('fx');
const end = document.getElementById('end');
const scoreText = document.getElementById('scoreText');
const msg = document.getElementById('msg');

/* ---------- INIT ---------- */
mountCard();
checkBtn.addEventListener('click', onCheck);

/* ---------- CARD RENDER ---------- */
function mountCard(){
  correctLine.classList.remove('show');
  correctLine.textContent = "";
  ans.classList.remove('shake');
  ans.innerHTML = "";

  const item = DATA[ order[i] ];
  jp.textContent = item.jp;
  hira.textContent = item.hira || "";

  // prepare words (already in the answer area, shuffled)
  const words = tokenize(item.en);
  const shuffled = shuffle(words.slice());
  shuffled.forEach((w, idx) => ans.appendChild(makeChip(w, idx)));

  enableReorder(ans); // drag-sort within the same container
}

/* tokenize words, keeping punctuation with the last token */
function tokenize(s){ return s.trim().split(/\s+/); }

/* create colored glowing chip */
function makeChip(text, idx){
  const el = document.createElement('button');
  el.type = "button";
  el.className = "word";
  el.textContent = text;
  el.style.setProperty('--chip', chipColor(idx));
  el.setAttribute('draggable','true');
  return el;
}

/* different solid glow color per position */
function chipColor(n){
  const palette = [
    "#ff6ec7","#5ee6ff","#ffd166","#8aff80","#c77dff",
    "#fff680","#ff9a8b","#9bffb7","#7cc6ff","#f7a6ff"
  ];
  return palette[n % palette.length];
}

/* enable drag-reorder inside container */
function enableReorder(container){
  let dragEl = null;
  container.addEventListener('dragstart', e=>{
    const t = e.target.closest('.word'); if(!t) return;
    dragEl = t; t.style.opacity = .7;
    e.dataTransfer?.setData('text/plain','x');
  });
  container.addEventListener('dragend', ()=>{ if(dragEl){ dragEl.style.opacity = 1; dragEl = null; }});
  container.addEventListener('dragover', e=>{
    e.preventDefault();
    const after = getDragAfterElement(container, e.clientX, e.clientY);
    if(!dragEl) return;
    if(after == null){ container.appendChild(dragEl); }
    else{ container.insertBefore(dragEl, after); }
  });
}
/* find insert position */
function getDragAfterElement(container, x, y){
  const els = [...container.querySelectorAll('.word:not([style*="opacity: 0.7"])')];
  return els.reduce((closest, child)=>{
    const box = child.getBoundingClientRect();
    const offset = y - (box.top + box.height / 2);
    if (offset < 0 && offset > closest.offset) return { offset, element: child };
    else return closest;
  }, { offset: Number.NEGATIVE_INFINITY }).element;
}

/* ---------- CHECK ---------- */
function onCheck(){
  const item = DATA[ order[i] ];
  const built = [...ans.children].map(el=>el.textContent).join(' ').trim();
  const correct = item.en.trim();

  if (built === correct){
    score++;
    bigHearts(ans);
    SND_OK.currentTime = 0; SND_OK.play().catch(()=>{});
    nextCard(1000);
  } else {
    // Show correct answer (below chips), smoke, shake, then next
    correctLine.textContent = "正解：" + correct;
    correctLine.classList.add('show');
    hugeSmoke(ans);
    ans.classList.remove('shake'); void ans.offsetWidth; ans.classList.add('shake');
    SND_BAD.currentTime = 0; SND_BAD.play().catch(()=>{});
    nextCard(1400);
  }
}

/* move to next or finish */
function nextCard(delay=1000){
  setTimeout(()=>{
    i++;
    if(i >= DATA.length){ return finish(); }
    mountCard();
  }, delay);
}

/* ---------- FINISH ---------- */
function finish(){
  document.querySelector('.panel').style.display = 'none';
  end.style.display = 'block';
  const pct = Math.round((score / DATA.length) * 100);
  scoreText.textContent = `スコア：${score} / ${DATA.length}（${pct}%）`;

  let line = "", snd = null;
  if(score <= 5){
    line = "だめだ〜！アニメをやめて、ブーリキュラムを見よう！";
    snd = SND_R0_5;
  } else if(score <= 10){
    line = "えっ？YouTubeばかり。Boo-tube を見よう！";
    snd = SND_R6_10;
  } else if(score <= 14){
    line = "いいね！でも満点を目指そう。";
    snd = SND_R15; // per your spec
  } else {
    line = "あなたは超天才！";
    snd = SND_R15;
  }
  msg.textContent = line;
  if(snd){ snd.currentTime = 0; snd.play().catch(()=>{}); }

  // celebratory hearts proportional to score
  bigHearts(document.body, 80 + Math.floor(160 * (score/DATA.length)));
}

/* ---------- FX: HUGE hearts & smoke ---------- */
function bigHearts(fromEl, count=48){
  const r = fromEl.getBoundingClientRect();
  const cx = r.left + r.width/2;
  const cy = r.top + r.height/2;
  for(let k=0;k<count;k++){
    const h = document.createElement('div');
    h.className = 'heart'; h.textContent = '❤';
    const dx = (Math.random()*window.innerWidth) - window.innerWidth/2;
    const dy = (Math.random()*200 - 100);
    const delay = Math.random()*180;
    h.style.left = (cx + dx*0.25) + 'px';
    h.style.top  = (cy + dy*0.25) + 'px';
    h.style.animationDelay = delay+'ms';
    fx.appendChild(h);
    setTimeout(()=> h.remove(), 1400);
  }
}
function hugeSmoke(fromEl, count=26){
  const r = fromEl.getBoundingClientRect();
  const cx = r.left + r.width/2;
  const cy = r.top + r.height/2 + 20;
  for(let k=0;k<count;k++){
    const s = document.createElement('div');
    s.className = 'smoke';
    const angle = (Math.random()*Math.PI) - Math.PI/2;
    const radius = Math.random()*220;
    const ox = Math.cos(angle)*radius;
    const oy = Math.sin(angle)*radius*0.5;
    const delay = Math.random()*140;
    s.style.left = (cx + ox) + 'px';
    s.style.top  = (cy + oy) + 'px';
    s.style.animationDelay = delay+'ms';
    fx.appendChild(s);
    setTimeout(()=> s.remove(), 1600);
  }
}

/* ---------- UTILS ---------- */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = (Math.random()*(i+1))|0;
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

/* Mobile scroll responsiveness (avoid sticky traps) */
document.addEventListener('touchmove', ()=>{}, {passive:true});
</script>
</body>
</html>
